/*
    Minified by Jellevdg3's minifier at 05/May/2014 23:03:25.
*/
Align=function(ratiox,ratioy){this.ratiox=ratiox;this.ratioy=ratioy;this.set();Align.aligns.push(this);};Align.aligns=[];Align.screenW=0;Align.screenH=0;Align.width=1980;Align.height=1080;Align.ratiox=0;Align.ratioy=0;Align.setSS=function(w,h){Align.screenW=w;Align.screenH=h;Align.ratiox=Align.screenW/Align.width;Align.ratioy=Align.screenH/Align.height;Align.ratiorevx=Align.width/Align.screenW;Align.ratiorevy=Align.height/Align.screenH;for(var i=0;i<Align.aligns.length;i++){Align.aligns[i].set();}};Align.prototype.set=function(){this.sw=this.x(Align.width);this.sh=this.y(Align.height);};Align.prototype.sx=function(){return this.sw;};Align.prototype.sy=function(){return this.sh;};Align.prototype.x=function(w){return parseInt(w*this.ratiox);};Align.prototype.y=function(h){return parseInt(h*this.ratioy);};Align.LEFT=new Align(0.0,0.0);Align.TOP=new Align(0.0,1.0);Align.CENTER=new Align(0.5,0.5);Align.RIGHT=new Align(1.0,0.0);Align.BOTTOM=new Align(0.0,1.0);Button=function(){this.texture=null;this.x=0;this.y=0;this.width=100;this.height=100;this.item=undefined;this.alignx=Align.LEFT;this.aligny=Align.TOP;};Button.prototype.setTexture=function(texture){this.texture=texture;};Button.prototype.setPosition=function(x,y){this.x=x;this.y=y;};Button.prototype.setSize=function(width,height){this.width=width;this.height=height;};Button.prototype.initialize=function(){if(this.item==undefined){console.error("Item is undefined.");}this.x-=parseInt(this.width/2);this.y-=parseInt(this.height/2);};Button.prototype.tick=function(){};Button.prototype.draw=function(gfx){gfx.drawTexture(this.texture,this.alignx.sx()+this.x,this.aligny.sy()+this.y,this.width,this.height);};Button.prototype.onClick=function(){};Canvas=function(){this.canvas=document.createElement("canvas");document.body.appendChild(this.canvas);this.gfx=new GFX(this);this.rescale();};Canvas.prototype.rescale=function(){this.width=window.innerWidth;this.height=window.innerHeight;this.x=0;this.y=0;var arg_width=Arguments.get("w");var arg_height=Arguments.get("h");if(arg_width!=undefined){this.width=parseInt(arg_width);this.x=parseInt((window.innerWidth/2)-(this.width/2));}if(arg_height!=undefined){this.height=parseInt(arg_height);this.y=parseInt((window.innerHeight/2)-(this.height/2));}this.canvas.width=this.width;this.canvas.height=this.height;Align.setSS(this.width,this.height);this.canvas.style.position="absolute";this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.canvas.style.left=this.x+"px";this.canvas.style.top=this.y+"px";this.rotated=false;this.gfx.gfx.translate(0,0);this.gfx.gfx.rotate(0);this.gfx.gfx.scale(1,1);if(this.height>this.width){Align.setSS(this.height,this.width);this.rotated=true;this.gfx.gfx.scale(Align.ratioy,Align.ratiox);this.gfx.gfx.translate(Align.height,0);this.gfx.gfx.rotate(90*Math.PI/180);}else{Align.setSS(this.width,this.height);this.gfx.gfx.rotate(0);this.gfx.gfx.scale(Align.ratiox,Align.ratioy);}};GFX=function(canvas){this.canvas=canvas;this.gfx=this.canvas.canvas.getContext("2d");};GFX.prototype.clear=function(style){this.gfx.fillStyle=style;this.gfx.fillRect(0,0,Align.width,Align.height);};GFX.prototype.drawRect=function(x,y,w,h,strokeStyle,lineWidth){this.gfx.lineWidth=lineWidth;this.gfx.strokeStyle=strokeStyle;this.gfx.strokeRect(x,y,w,h);};GFX.prototype.fillRect=function(x,y,w,h,fillStyle){this.gfx.fillStyle=fillStyle;this.gfx.fillRect(x,y,w,h);};GFX.prototype.drawString=function(text,x,y,fillstyle,font){this.gfx.fillStyle=fillstyle;this.gfx.font=font;this.gfx.fillText(text,x,(y+6));};GFX.prototype.drawCenteredString=function(text,x,y,fillstyle,font){var metrics=this.gfx.measureText(text);this.drawString(text,(x-(metrics.width/2)),y,fillstyle,font);};GFX.prototype.drawTexture=function(texture,x,y,width,height){this.gfx.drawImage(texture,x,y,width,height);};MouseEvent=function(){this.x=0;this.y=0;this.ticksAlive=0;this.remove=false;};MouseEvent.prototype.tick=function(){this.ticksAlive++;if(this.ticksAlive>1){this.remove=true;}};WindowKeyboardListener=function(){};WindowMouseListener=function(){this.mousedown=[];this.isMouseDown=false;this.mouseDownEvent=new EventHandler(this,this.onMouseDown);window.onmousedown=this.mouseDownEvent.execute;window.ontouchstart=this.mouseDownEvent.execute;};WindowMouseListener.prototype.tick=function(){for(var i=0;i<this.mousedown.length;i++){this.mousedown[i].tick();if(this.mousedown[i].remove==true){this.mousedown.splice(i,1);i--;}}this.isMouseDown=this.mousedown.length!=0;};WindowMouseListener.prototype.onMouseDown=function(ev){ev.preventDefault();var mouseEvent=new MouseEvent();var rx=0;var ry=0;if(ev.touches){var i=this.mousedown.length;rx=ev.touches[i].pageX;ry=ev.touches[i].pageY;}else{rx=ev.pageX;ry=ev.pageY;}if(this.windowHandler.canvas.rotated==true){mouseEvent.y=Align.height-((rx-this.windowHandler.canvas.x)*Align.ratiorevy);mouseEvent.x=((ry-this.windowHandler.canvas.y)*Align.ratiorevx);}else{mouseEvent.x=((rx-this.windowHandler.canvas.x)*Align.ratiorevx);mouseEvent.y=((ry-this.windowHandler.canvas.y)*Align.ratiorevy);}this.mousedown.push(mouseEvent);};Arguments=function(){};Arguments.args=[];Arguments.add=function(key,value){Arguments.args[key]=value;};Arguments.initialize=function(){var location=window.location.href.toString();if(location.indexOf("?")!=-1){var arguments=location.substr(location.indexOf("?")+1).split("&");for(var i=0;i<arguments.length;i++){var data=arguments[i].split("=");if(data.length==2){var key=data[0];var value=data[1];if(key!=undefined&&value!=undefined){Arguments.add(key,value);}}}}};Arguments.get=function(key){return Arguments.args[key];};EventHandler=function(object,executeFunction){this.object=object;this.executeFunction=executeFunction;var instance=this;this.execute=function(args){instance.executeFunction.call(instance.object,args);};};ItemHandler=function(){this.curItem=null;this.gotoItem=null;this.loadedItems=[];};ItemHandler.prototype.setGotoItem=function(item){this.gotoItem=item;};ItemHandler.prototype.tick=function(){if(this.gotoItem!=null){if(this.curItem!=null){this.curItem.deActivate();}var found=null;for(var i=0;i<this.loadedItems.length;i++){if(this.loadedItems[i].constructor==this.gotoItem){found=this.loadedItems[i];break;}}if(found==undefined){this.curItem=new this.gotoItem();this.loadedItems.push(this.curItem);}else{this.curItem=found;}this.gotoItem=null;if(!this.curItem.hasInitialized){this.curItem.itemHandler=this;this.curItem.hasInitialized=true;this.curItem.initialize();}this.curItem.activate();}this.curItem.tick();};ItemHandler.prototype.draw=function(gfx){this.curItem.draw(gfx);};Loader=function(fileComponents){this.completeEventHandler=new EventHandler(this,this.loadComplete);this.fileComponents=fileComponents;this.index=0;this.done=false;};Loader.prototype.start=function(){if(this.hasNext()==true){this.loadNext();}else{this.done=true;}};Loader.prototype.stringEndsWidth=function(text,suffix){return text.indexOf(suffix,text.length-suffix.length)!==-1;};Loader.prototype.hasNext=function(){return this.index<this.fileComponents.length;};Loader.prototype.loadImage=function(path){console.log("Image path: "+path);var obj=new Image();obj.onload=this.completeEventHandler.execute;obj.onerror=this.completeEventHandler.execute;obj.src=path;return obj;};Loader.prototype.loadNext=function(){if(this.stringEndsWidth(this.fileComponents[this.index].path,".jpg")){this.fileComponents[this.index].obj=this.loadImage(this.fileComponents[this.index].path);}if(this.stringEndsWidth(this.fileComponents[this.index].path,".png")){this.fileComponents[this.index].obj=this.loadImage(this.fileComponents[this.index].path);}};Loader.prototype.loadComplete=function(){this.index+=1;if(this.hasNext()==true){this.loadNext();}else{this.done=true;}};Ticker=function(){this.tickEventHandler=new EventHandler(this,this.tick);this.fps=60;this.curTime=0;this.lastTickTime=0;this.curFPSCount=0;this.lastFPSCountTime=0;this.curFPS=0;this.lastSleep=0;this.restSleep=0;this.handler=function(){};this.handler.tick=function(){};};Ticker.prototype.start=function(){this.curTime=this.getCurTime();this.lastTickTime=this.curTime;this.lastFPSCountTime=this.curTime;setTimeout(this.tickEventHandler.execute,1);};Ticker.prototype.getCurTime=function(){return Date.now();};Ticker.prototype.tick=function(){this.handler.tick();this.lastTickTime=this.curTime+this.lastSleep;this.curTime=this.getCurTime();if(this.curTime-this.lastFPSCountTime>=1000){this.lastFPSCountTime=this.curTime;this.curFPS=this.curFPSCount;console.log("FPS: "+this.curFPS);this.curFPSCount=0;}this.curFPSCount++;var delta=this.curTime-this.lastTickTime;var sleep=(1000.0/this.fps)-delta+this.restSleep;this.restSleep=sleep%1;if(sleep>=1){sleep=parseInt(sleep);this.lastSleep=sleep;setTimeout(this.tickEventHandler.execute,sleep);}else{this.lastSleep=1;setTimeout(this.tickEventHandler.execute,1);}};WindowHandler=function(){document.body.style.overflow="hidden";this.canvas=new Canvas();this.gfx=this.canvas.gfx;this.keyboardListener=new WindowKeyboardListener();this.mouseListener=new WindowMouseListener();this.keyboardListener.windowHandler=this;this.mouseListener.windowHandler=this;this.ticker=new Ticker();this.itemHandler=new ItemHandler();this.itemHandler.windowHandler=this;this.ticker.handler=this;this.itemHandler.setGotoItem(ItemInitialize);this.ticker.start();};WindowHandler.prototype.isMouseDown=function(){return this.mouseListener.isMouseDown;};WindowHandler.prototype.getMousesDown=function(){return this.mouseListener.mousedown;};WindowHandler.prototype.tick=function(){if(window.innerWidth!=this.canvas.width||window.innerHeight!=this.canvas.height){this.canvas.rescale();}this.mouseListener.tick();this.itemHandler.tick();this.itemHandler.draw(this.gfx);};ItemMainMenu=function(){this.backgroundTexture=Files.PIC_MENU_BACKGROUND.obj;this.lastMouseX=0;this.lastMouseY=0;this.playButton=new Button();this.playButton.alignx=Align.CENTER;this.playButton.aligny=Align.CENTER;this.playButton.setTexture(Files.PIC_MENU_BUTTON_PLAY.obj);this.playButton.setPosition(0,0);this.playButton.setSize(Files.PIC_MENU_BUTTON_PLAY.obj.width,Files.PIC_MENU_BUTTON_PLAY.obj.height);};ItemMainMenu.prototype.initialize=function(){this.playButton.item=this;this.playButton.initialize();};ItemMainMenu.prototype.activate=function(){};ItemMainMenu.prototype.deActivate=function(){};ItemMainMenu.prototype.tick=function(){this.playButton.tick();if(this.itemHandler.windowHandler.isMouseDown()==true){var mouse=this.itemHandler.windowHandler.getMousesDown()[0];this.lastMouseX=mouse.x;this.lastMouseY=mouse.y;}};ItemMainMenu.prototype.draw=function(gfx){gfx.clear("black");gfx.drawTexture(this.backgroundTexture,0,0,Align.width,Align.height);gfx.fillRect(this.lastMouseX-10,this.lastMouseY-10,20,20,"yellow");this.playButton.draw(gfx);};ItemTestMenu=function(){};ItemTestMenu.prototype.initialize=function(){};ItemTestMenu.prototype.activate=function(){};ItemTestMenu.prototype.deActivate=function(){};ItemTestMenu.prototype.tick=function(){};ItemTestMenu.prototype.draw=function(gfx){gfx.clear("yellow");};ItemInitialize=function(){};ItemInitialize.prototype.initialize=function(){this.loader=new Loader(Files.prefiles);this.loader.start();};ItemInitialize.prototype.activate=function(){};ItemInitialize.prototype.deActivate=function(){};ItemInitialize.prototype.tick=function(){if(this.loader.done==true){this.itemHandler.setGotoItem(ItemLoader);}};ItemInitialize.prototype.draw=function(gfx){gfx.clear("black");};ItemLoader=function(){this.backgroundTexture=Files.PIC_LOADER_BACKGROUND.obj;this.loader=new Loader(Files.files);this.loader.start();};ItemLoader.prototype.initialize=function(){};ItemLoader.prototype.activate=function(){};ItemLoader.prototype.deActivate=function(){};ItemLoader.prototype.tick=function(){if(this.loader.done==true){this.itemHandler.setGotoItem(ItemMainMenu);}};ItemLoader.prototype.draw=function(gfx){gfx.clear("black");gfx.drawTexture(this.backgroundTexture,0,0,Align.width,Align.height);gfx.drawCenteredString("Loading...",Align.width/2,Align.height/2,"black","120px Arial");};FileComponent=function(){this.path="";this.obj=null;};Files=function(){};Files.prefiles=[];Files.files=[];Files.addPreFile=function(path){if(path!=undefined&&path!=""){var component=new FileComponent();component.path=path;Files.prefiles.push(component);return component;}};Files.addFile=function(path){if(path!=undefined&&path!=""){var component=new FileComponent();component.path=path;Files.files.push(component);return component;}};Files.PIC_LOADER_BACKGROUND=Files.addPreFile("PreAssets/background.jpg");Files.PIC_MENU_BACKGROUND=Files.addFile("Assets/Menu/background.jpg");Files.PIC_MENU_BUTTON_PLAY=Files.addFile("Assets/Menu/PlayButton.png");Files.PIC_MENU_BUTTON_BACK=Files.addFile("Assets/Menu/BackButton.png");window.onload=function(){new Main();};Main=function(){console.log("Starting...");Arguments.initialize();var mywindow=new WindowHandler();};